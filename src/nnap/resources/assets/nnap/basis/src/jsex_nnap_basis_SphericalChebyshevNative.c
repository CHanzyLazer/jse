#include "jsex_nnap_basis_SphericalChebyshevNative.h"

#include <math.h>

#ifdef __cplusplus
extern "C" {
#endif

#define JSE_DBL_MIN_NORMAL (2.2250738585072014E-308)
#define JSE_EPS_MUL (8)
#define JSE_DBL_EPSILON (1.0e-10)

#define SQRT2_INV (0.7071067811865475)
#define SH_LARGEST_L (20)

#define WIGNER_222_000 (-0.23904572186687872)
#define WIGNER_222_011 (0.11952286093343936)
#define WIGNER_222_022 (0.23904572186687872)
#define WIGNER_222_112 (-0.29277002188455997)

#define WIGNER_112_000 (0.3651483716701107)
#define WIGNER_112_011 (-0.3162277660168379)
#define WIGNER_112_110 (0.18257418583505536)
#define WIGNER_112_112 (0.44721359549995787)

#define WIGNER_233_000 (0.19518001458970663)
#define WIGNER_233_011 (-0.14638501094227996)
#define WIGNER_233_022 (-0.0)
#define WIGNER_233_033 (0.2439750182371333)
#define WIGNER_233_110 (-0.06900655593423542)
#define WIGNER_233_220 (-0.2182178902359924)
#define WIGNER_233_112 (0.1889822365046136)
#define WIGNER_233_211 (0.23904572186687872)
#define WIGNER_233_123 (-0.2439750182371333)
#define WIGNER_233_213 (0.15430334996209188)

#define WIGNER_123_000 (-0.29277002188455997)
#define WIGNER_123_011 (0.2760262237369417)
#define WIGNER_123_022 (-0.2182178902359924)
#define WIGNER_123_110 (-0.1690308509457033)
#define WIGNER_123_101 (0.23904572186687872)
#define WIGNER_123_112 (-0.3086066999241838)
#define WIGNER_123_121 ( 0.09759000729485331)
#define WIGNER_123_123 (0.3779644730092272)

#define WIGNER_444_000 (0.13409704688030227)
#define WIGNER_444_011 (-0.06704852344015112)
#define WIGNER_444_022 (-0.08194819531574027)
#define WIGNER_444_033 (0.15644655469368596)
#define WIGNER_444_044 (0.10429770312912397)
#define WIGNER_444_112 (0.14135069854804388)
#define WIGNER_444_224 (0.18698939800169143)
#define WIGNER_444_123 (-0.06232979933389714)
#define WIGNER_444_134 (-0.1649091483060512)

#define WIGNER_224_000 (0.23904572186687872)
#define WIGNER_224_011 (-0.21821789023599236)
#define WIGNER_224_022 (0.15430334996209188)
#define WIGNER_224_110 (0.15936381457791915)
#define WIGNER_224_220 (0.03984095364447979)
#define WIGNER_224_112 (0.25197631533948484)
#define WIGNER_224_224 (0.3333333333333333)
#define WIGNER_224_121 (-0.0890870806374748)
#define WIGNER_224_123 (-0.23570226039551587)

#define WIGNER_334_000 (-0.16116459280507608)
#define WIGNER_334_011 (0.10403129732205986)
#define WIGNER_334_022 (0.046524210519923545)
#define WIGNER_334_033 (-0.21320071635561044)
#define WIGNER_334_110 (0.02686076546751269)
#define WIGNER_334_220 (0.18802535827258873)
#define WIGNER_334_330 (0.08058229640253803)
#define WIGNER_334_112 (-0.1698823971458752)
#define WIGNER_334_224 (-0.2247332874877474)
#define WIGNER_334_121 (-0.15194743527951726)
#define WIGNER_334_123 (0.10050378152592121)
#define WIGNER_334_132 (0.1973855084879307)
#define WIGNER_334_231 (-0.14712247158412492)
#define WIGNER_334_134 (0.17407765595569782)

#define WIGNER_244_000 (-0.1698823971458752)
#define WIGNER_244_011 (0.14440003757399392)
#define WIGNER_244_022 (-0.06795295885835007)
#define WIGNER_244_033 (-0.059458839001056314)
#define WIGNER_244_044 (0.23783535600422528)
#define WIGNER_244_110 (0.046524210519923545)
#define WIGNER_244_220 (0.19738550848793068)
#define WIGNER_244_211 (-0.20806259464411975)
#define WIGNER_244_112 (-0.13241022442571243)
#define WIGNER_244_224 (0.11009637651263607)
#define WIGNER_244_123 (0.19462473604038075)
#define WIGNER_244_213 (-0.1651445647689541)
#define WIGNER_244_134 (-0.2059714602177749)

#define WIGNER_134_000 (0.25197631533948484)
#define WIGNER_134_011 (-0.2439750182371333)
#define WIGNER_134_022 (0.2182178902359924)
#define WIGNER_134_033 (-0.16666666666666669)
#define WIGNER_134_110 (0.1543033499620919)
#define WIGNER_134_101 (-0.19920476822239896)
#define WIGNER_134_112 (0.2439750182371333)
#define WIGNER_134_121 (-0.1091089451179962)
#define WIGNER_134_123 (-0.2886751345948129)
#define WIGNER_134_132 (0.06299407883487121)
#define WIGNER_134_134 (0.33333333333333337)

#define PI4 (12.566370614359172)

static const jint L3NCOLS[5] = {0, 0, 2, 4, 9};
static const jint L3NCOLS_NOCROSS[5] = {0, 0, 1, 1, 2};
static const double SQRT_LPM_LMM1[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    0.0, 1.4142135623730951, 1.4142135623730951,
    0.0, 2.0, 2.449489742783178, 2.449489742783178, 2.0,
    0.0, 2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178,
    0.0, 2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903,
    0.0, 3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795,
    0.0, 3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544,
    0.0, 3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413,
    0.0, 4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0,
    0.0, 4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285,
    0.0, 4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958,
    0.0, 4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343,
    0.0, 4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356,
    0.0, 5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845,
    0.0, 5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181,
    0.0, 5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661,
    0.0, 5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381,
    0.0, 5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301,
    0.0, 6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0,
    0.0, 6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976,
    0.0, 6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759
};
static const double SQRT_LPM1_LMM[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    1.4142135623730951, 1.4142135623730951, 0.0,
    2.0, 2.449489742783178, 2.449489742783178, 2.0, 0.0,
    2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178, 0.0,
    2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903, 0.0,
    3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795, 0.0,
    3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544, 0.0,
    3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413, 0.0,
    4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0, 0.0,
    4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285, 0.0,
    4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958, 0.0,
    4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343, 0.0,
    4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356, 0.0,
    5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845, 0.0,
    5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181, 0.0,
    5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661, 0.0,
    5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381, 0.0,
    5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301, 0.0,
    6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0, 0.0,
    6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976, 0.0,
    6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759, 0.0
};


static inline double pow2(double value) {
    return value * value;
}
static inline double pow3(double value) {
    return value * value * value;
}
static inline jboolean numericEqual(double aLHS, double aRHS) {
    double tNorm = fabs(aLHS) + fabs(aRHS);
    if (tNorm < JSE_DBL_MIN_NORMAL * JSE_EPS_MUL) return JNI_TRUE;
    double tDiff = fabs(aLHS - aRHS);
    return (tDiff <= tNorm * JSE_DBL_EPSILON) ? JNI_TRUE : JNI_FALSE;
}

static inline double chebyshev2(jint aN, double aX) {
    switch(aN) {
    case 0: {return 1.0;}
    case 1: {return 2.0 * aX;}
    default: {return 2.0 * aX * chebyshev2(aN - 1, aX) - chebyshev2(aN - 2, aX);}
    }
}


static inline void calRnPxyz(double *rRnPx, double *rRnPy, double *rRnPz, jint aNMax,
                             double aDis, double aRCut, double aDx, double aDy, double aDz) {
    const double tX = 1.0 - 2.0*aDis/aRCut;
    const double tRnPMul = 2.0 / (aDis*aRCut);
    rRnPx[0] = 0.0; rRnPy[0] = 0.0; rRnPz[0] = 0.0;
    for (jint tN = 1; tN <= aNMax; ++tN) {
        const double tRnP = tN*chebyshev2(tN-1, tX)*tRnPMul;
        rRnPx[tN] = tRnP*aDx;
        rRnPy[tN] = tRnP*aDy;
        rRnPz[tN] = tRnP*aDz;
    }
}
static inline void calYPphi(double *rYPphi, double *aY, jint aL) {
    const jint tStart = aL*aL;
    const jint tIdx = tStart+aL;
    for (jint tM = -aL; tM <= aL; ++tM) {
        rYPphi[tIdx+tM] = -tM * aY[tIdx-tM];
    }
}
static inline void calYPtheta(double aCosPhi, double aSinPhi, double *rYPtheta, double *aY, jint aL) {
    switch(aL) {
    case 0: {
        rYPtheta[0] = 0.0;
        return;
    }
    case 1: {
        double tMul = SQRT_LPM_LMM1[2]*SQRT2_INV;
        rYPtheta[1] = -tMul * aSinPhi*aY[2];
        rYPtheta[2] =  tMul * (aCosPhi*aY[3] + aSinPhi*aY[1]);
        rYPtheta[3] = -tMul * aCosPhi*aY[2];
        return;
    }
    default: {
        const jint tStart = aL*aL;
        const jint tIdx = tStart+aL;
        double tMul = SQRT_LPM_LMM1[tIdx]*SQRT2_INV;
        rYPtheta[tIdx] = tMul * (aCosPhi*aY[tIdx+1] + aSinPhi*aY[tIdx-1]);
        rYPtheta[tIdx+1] = -tMul * aCosPhi*aY[tIdx];
        rYPtheta[tIdx-1] = -tMul * aSinPhi*aY[tIdx];
        for (jint tM = 2; tM <= aL; ++tM) {
            tMul = -0.5*SQRT_LPM_LMM1[tIdx+tM];
            rYPtheta[tIdx+tM] = tMul * (aCosPhi*aY[tIdx+tM-1] - aSinPhi*aY[tIdx-tM+1]);
            rYPtheta[tIdx-tM] = tMul * (aCosPhi*aY[tIdx-tM+1] + aSinPhi*aY[tIdx+tM-1]);
        }
        for (jint tM = 1; tM < aL; ++tM) {
            tMul = 0.5*SQRT_LPM1_LMM[tIdx+tM];
            rYPtheta[tIdx+tM] += tMul * (aCosPhi*aY[tIdx+tM+1] + aSinPhi*aY[tIdx-tM-1]);
            rYPtheta[tIdx-tM] += tMul * (aCosPhi*aY[tIdx-tM-1] - aSinPhi*aY[tIdx+tM+1]);
        }
        return;
    }}
}
static inline void calYPxyz(double aCosTheta, double aSinTheta, double aCosPhi, double aSinPhi, double aDis, double aDxy, jboolean aDxyCloseZero,
                            double *rYPx, double *rYPy, double *rYPz, double *aYPtheta, double *aYPphi, jint aLength) {
    const double thetaPx = -aCosTheta * aCosPhi / aDis;
    const double thetaPy = -aCosTheta * aSinPhi / aDis;
    const double thetaPz =  aSinTheta / aDis;
    const double phiPx = aDxyCloseZero ? 0.0 :  aSinPhi / aDxy;
    const double phiPy = aDxyCloseZero ? 0.0 : -aCosPhi / aDxy;
    for (jint i = 0; i < aLength; ++i) {
        const double tYPtheta = aYPtheta[i];
        const double tYPphi = aYPphi[i];
        rYPx[i] = tYPtheta*thetaPx + tYPphi*phiPx;
        rYPy[i] = tYPtheta*thetaPy + tYPphi*phiPy;
        rYPz[i] = tYPtheta*thetaPz;
    }
}
static inline void calCnlmPxyz(double *rCnlmPx, double *rCnlmPy, double *rCnlmPz,
                               double *aY, double *aYPx, double *aYPy, double *aYPz,
                               double aFc, double aFcPx, double aFcPy, double aFcPz,
                               double aRn, double aRnPx, double aRnPy, double aRnPz, jint aLength) {
    const double tMul = -(aFc*aRn);
    const double tMulX = -(aFc*aRnPx + aFcPx*aRn);
    const double tMulY = -(aFc*aRnPy + aFcPy*aRn);
    const double tMulZ = -(aFc*aRnPz + aFcPz*aRn);
    for (jint i = 0; i < aLength; ++i) {
        const double tY = aY[i];
        rCnlmPx[i] = tMulX*tY + tMul*aYPx[i];
        rCnlmPy[i] = tMulY*tY + tMul*aYPy[i];
        rCnlmPz[i] = tMulZ*tY + tMul*aYPz[i];
    }
}

static inline void putFpPxyz_(double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aSubFpPx, double aSubFpPy, double aSubFpPz, jint aIdxFp) {
    rFpPx[aIdxFp] -= aSubFpPx;
    rFpPy[aIdxFp] -= aSubFpPy;
    rFpPz[aIdxFp] -= aSubFpPz;
    if (rFpPxCross != NULL) {
        rFpPxCross[aIdxFp] += aSubFpPx;
        rFpPyCross[aIdxFp] += aSubFpPy;
        rFpPzCross[aIdxFp] += aSubFpPz;
    }
}
static inline void calL2_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                          double *rFpPx, double *rFpPy, double *rFpPz,
                          double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                          double aWt, jint aLMax) {
    // l = 0
    double tCnl0 = aCnlm[0];
    double tMul = aWt*(PI4+PI4);
    double subFpPx = tMul * (tCnl0*aCnlmPx[0]);
    double subFpPy = tMul * (tCnl0*aCnlmPy[0]);
    double subFpPz = tMul * (tCnl0*aCnlmPz[0]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 0);
    if (aLMax == 0) return;
    // l = 1
    tCnl0 = aCnlm[1]; double tCnl1 = aCnlm[1+1], tCnl2 = aCnlm[1+2];
    tMul = aWt*(PI4/3 + PI4/3);
    subFpPx = tMul * (tCnl0*aCnlmPx[1] + tCnl1*aCnlmPx[1+1] + tCnl2*aCnlmPx[1+2]);
    subFpPy = tMul * (tCnl0*aCnlmPy[1] + tCnl1*aCnlmPy[1+1] + tCnl2*aCnlmPy[1+2]);
    subFpPz = tMul * (tCnl0*aCnlmPz[1] + tCnl1*aCnlmPz[1+1] + tCnl2*aCnlmPz[1+2]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 1);
    if (aLMax == 1) return;
    // l = 2
    tCnl0 = aCnlm[4]; tCnl1 = aCnlm[4+1]; tCnl2 = aCnlm[4+2]; double tCnl3 = aCnlm[4+3], tCnl4 = aCnlm[4+4];
    tMul = aWt*(PI4/5 + PI4/5);
    subFpPx = tMul * (tCnl0*aCnlmPx[4] + tCnl1*aCnlmPx[4+1] + tCnl2*aCnlmPx[4+2] + tCnl3*aCnlmPx[4+3] + tCnl4*aCnlmPx[4+4]);
    subFpPy = tMul * (tCnl0*aCnlmPy[4] + tCnl1*aCnlmPy[4+1] + tCnl2*aCnlmPy[4+2] + tCnl3*aCnlmPy[4+3] + tCnl4*aCnlmPy[4+4]);
    subFpPz = tMul * (tCnl0*aCnlmPz[4] + tCnl1*aCnlmPz[4+1] + tCnl2*aCnlmPz[4+2] + tCnl3*aCnlmPz[4+3] + tCnl4*aCnlmPz[4+4]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 2);
    if (aLMax == 2) return;
    // l = 3
    tCnl0 = aCnlm[9]; tCnl1 = aCnlm[9+1]; tCnl2 = aCnlm[9+2]; tCnl3 = aCnlm[9+3]; tCnl4 = aCnlm[9+4]; double tCnl5 = aCnlm[9+5], tCnl6 = aCnlm[9+6];
    tMul = aWt*(PI4/7 + PI4/7);
    subFpPx = tMul * (tCnl0*aCnlmPx[9] + tCnl1*aCnlmPx[9+1] + tCnl2*aCnlmPx[9+2] + tCnl3*aCnlmPx[9+3] + tCnl4*aCnlmPx[9+4] + tCnl5*aCnlmPx[9+5] + tCnl6*aCnlmPx[9+6]);
    subFpPy = tMul * (tCnl0*aCnlmPy[9] + tCnl1*aCnlmPy[9+1] + tCnl2*aCnlmPy[9+2] + tCnl3*aCnlmPy[9+3] + tCnl4*aCnlmPy[9+4] + tCnl5*aCnlmPy[9+5] + tCnl6*aCnlmPy[9+6]);
    subFpPz = tMul * (tCnl0*aCnlmPz[9] + tCnl1*aCnlmPz[9+1] + tCnl2*aCnlmPz[9+2] + tCnl3*aCnlmPz[9+3] + tCnl4*aCnlmPz[9+4] + tCnl5*aCnlmPz[9+5] + tCnl6*aCnlmPz[9+6]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 3);
    if (aLMax == 3) return;
    // l = 4
    tCnl0 = aCnlm[16]; tCnl1 = aCnlm[16+1]; tCnl2 = aCnlm[16+2]; tCnl3 = aCnlm[16+3]; tCnl4 = aCnlm[16+4]; tCnl5 = aCnlm[16+5]; tCnl6 = aCnlm[16+6]; double tCnl7 = aCnlm[16+7], tCnl8 = aCnlm[16+8];
    tMul = aWt*(PI4/9 + PI4/9);
    subFpPx = tMul * (tCnl0*aCnlmPx[16] + tCnl1*aCnlmPx[16+1] + tCnl2*aCnlmPx[16+2] + tCnl3*aCnlmPx[16+3] + tCnl4*aCnlmPx[16+4] + tCnl5*aCnlmPx[16+5] + tCnl6*aCnlmPx[16+6] + tCnl7*aCnlmPx[16+7] + tCnl8*aCnlmPx[16+8]);
    subFpPy = tMul * (tCnl0*aCnlmPy[16] + tCnl1*aCnlmPy[16+1] + tCnl2*aCnlmPy[16+2] + tCnl3*aCnlmPy[16+3] + tCnl4*aCnlmPy[16+4] + tCnl5*aCnlmPy[16+5] + tCnl6*aCnlmPy[16+6] + tCnl7*aCnlmPy[16+7] + tCnl8*aCnlmPy[16+8]);
    subFpPz = tMul * (tCnl0*aCnlmPz[16] + tCnl1*aCnlmPz[16+1] + tCnl2*aCnlmPz[16+2] + tCnl3*aCnlmPz[16+3] + tCnl4*aCnlmPz[16+4] + tCnl5*aCnlmPz[16+5] + tCnl6*aCnlmPz[16+6] + tCnl7*aCnlmPz[16+7] + tCnl8*aCnlmPz[16+8]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 4);
    if (aLMax == 4) return;
    // l = 5
    tCnl0 = aCnlm[25]; tCnl1 = aCnlm[25+1]; tCnl2 = aCnlm[25+2]; tCnl3 = aCnlm[25+3]; tCnl4 = aCnlm[25+4]; tCnl5 = aCnlm[25+5]; tCnl6 = aCnlm[25+6]; tCnl7 = aCnlm[25+7]; tCnl8 = aCnlm[25+8]; double tCnl9 = aCnlm[25+9], tCnl10 = aCnlm[25+10];
    tMul = aWt*(PI4/11 + PI4/11);
    subFpPx = tMul * (tCnl0*aCnlmPx[25] + tCnl1*aCnlmPx[25+1] + tCnl2*aCnlmPx[25+2] + tCnl3*aCnlmPx[25+3] + tCnl4*aCnlmPx[25+4] + tCnl5*aCnlmPx[25+5] + tCnl6*aCnlmPx[25+6] + tCnl7*aCnlmPx[25+7] + tCnl8*aCnlmPx[25+8] + tCnl9*aCnlmPx[25+9] + tCnl10*aCnlmPx[25+10]);
    subFpPy = tMul * (tCnl0*aCnlmPy[25] + tCnl1*aCnlmPy[25+1] + tCnl2*aCnlmPy[25+2] + tCnl3*aCnlmPy[25+3] + tCnl4*aCnlmPy[25+4] + tCnl5*aCnlmPy[25+5] + tCnl6*aCnlmPy[25+6] + tCnl7*aCnlmPy[25+7] + tCnl8*aCnlmPy[25+8] + tCnl9*aCnlmPy[25+9] + tCnl10*aCnlmPy[25+10]);
    subFpPz = tMul * (tCnl0*aCnlmPz[25] + tCnl1*aCnlmPz[25+1] + tCnl2*aCnlmPz[25+2] + tCnl3*aCnlmPz[25+3] + tCnl4*aCnlmPz[25+4] + tCnl5*aCnlmPz[25+5] + tCnl6*aCnlmPz[25+6] + tCnl7*aCnlmPz[25+7] + tCnl8*aCnlmPz[25+8] + tCnl9*aCnlmPz[25+9] + tCnl10*aCnlmPz[25+10]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 5);
    if (aLMax == 5) return;
    // l = 6
    tCnl0 = aCnlm[36]; tCnl1 = aCnlm[36+1]; tCnl2 = aCnlm[36+2]; tCnl3 = aCnlm[36+3]; tCnl4 = aCnlm[36+4]; tCnl5 = aCnlm[36+5]; tCnl6 = aCnlm[36+6]; tCnl7 = aCnlm[36+7]; tCnl8 = aCnlm[36+8]; tCnl9 = aCnlm[36+9]; tCnl10 = aCnlm[36+10]; double tCnl11 = aCnlm[36+11], tCnl12 = aCnlm[36+12];
    tMul = aWt*(PI4/13 + PI4/13);
    subFpPx = tMul * (tCnl0*aCnlmPx[36] + tCnl1*aCnlmPx[36+1] + tCnl2*aCnlmPx[36+2] + tCnl3*aCnlmPx[36+3] + tCnl4*aCnlmPx[36+4] + tCnl5*aCnlmPx[36+5] + tCnl6*aCnlmPx[36+6] + tCnl7*aCnlmPx[36+7] + tCnl8*aCnlmPx[36+8] + tCnl9*aCnlmPx[36+9] + tCnl10*aCnlmPx[36+10] + tCnl11*aCnlmPx[36+11] + tCnl12*aCnlmPx[36+12]);
    subFpPy = tMul * (tCnl0*aCnlmPy[36] + tCnl1*aCnlmPy[36+1] + tCnl2*aCnlmPy[36+2] + tCnl3*aCnlmPy[36+3] + tCnl4*aCnlmPy[36+4] + tCnl5*aCnlmPy[36+5] + tCnl6*aCnlmPy[36+6] + tCnl7*aCnlmPy[36+7] + tCnl8*aCnlmPy[36+8] + tCnl9*aCnlmPy[36+9] + tCnl10*aCnlmPy[36+10] + tCnl11*aCnlmPy[36+11] + tCnl12*aCnlmPy[36+12]);
    subFpPz = tMul * (tCnl0*aCnlmPz[36] + tCnl1*aCnlmPz[36+1] + tCnl2*aCnlmPz[36+2] + tCnl3*aCnlmPz[36+3] + tCnl4*aCnlmPz[36+4] + tCnl5*aCnlmPz[36+5] + tCnl6*aCnlmPz[36+6] + tCnl7*aCnlmPz[36+7] + tCnl8*aCnlmPz[36+8] + tCnl9*aCnlmPz[36+9] + tCnl10*aCnlmPz[36+10] + tCnl11*aCnlmPz[36+11] + tCnl12*aCnlmPz[36+12]);
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, 6);
    if (aLMax == 6) return;
    // else
    for (jint tL = 7; tL <= aLMax; ++tL) {
        const jint tStart = tL*tL;
        const jint tLen = tL+tL+1;
        const jint tEnd = tStart+tLen;
        double rDotPx = 0.0, rDotPy = 0.0, rDotPz = 0.0;
        for (jint i=tStart; i < tEnd; ++i) {
            double tCnlm = aCnlm[i];
            rDotPx += tCnlm*aCnlmPx[i];
            rDotPy += tCnlm*aCnlmPy[i];
            rDotPz += tCnlm*aCnlmPz[i];
        }
        tMul = PI4/(double)tLen;
        tMul = aWt*(tMul+tMul);
        subFpPx = tMul * rDotPx;
        subFpPy = tMul * rDotPy;
        subFpPz = tMul * rDotPz;
        putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, subFpPx, subFpPy, subFpPz, tL);
    }
}

static inline void calL3_222_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx = 2*2+2;
    const double c20  = aCnlm[tIdx  ];
    const double c21  = aCnlm[tIdx+1];
    const double c2n1 = aCnlm[tIdx-1];
    const double c22  = aCnlm[tIdx+2];
    const double c2n2 = aCnlm[tIdx-2];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = (3.0*WIGNER_222_000)*c20*c20 - (3.0*WIGNER_222_011)*(c21*c21 + c2n1*c2n1) + (3.0*WIGNER_222_022)*(c22*c22 + c2n2*c2n2);
    rFp3Px += tMul*aCnlmPx[tIdx];
    rFp3Py += tMul*aCnlmPy[tIdx];
    rFp3Pz += tMul*aCnlmPz[tIdx];
    
    double tMul1 = (-6.0*WIGNER_222_011)*c20*c21  + (6.0*SQRT2_INV*WIGNER_222_112)*c22*c21  + (6.0*SQRT2_INV*WIGNER_222_112)*c2n1*c2n2;
    double tMul2 = (-6.0*WIGNER_222_011)*c20*c2n1 - (6.0*SQRT2_INV*WIGNER_222_112)*c22*c2n1 + (6.0*SQRT2_INV*WIGNER_222_112)*c21*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx+1] + tMul2*aCnlmPx[tIdx-1];
    rFp3Py += tMul1*aCnlmPy[tIdx+1] + tMul2*aCnlmPy[tIdx-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx+1] + tMul2*aCnlmPz[tIdx-1];
    tMul1 = (6.0*WIGNER_222_022)*c20*c22  + (3.0*SQRT2_INV*WIGNER_222_112)*(c21*c21 - c2n1*c2n1);
    tMul2 = (6.0*WIGNER_222_022)*c20*c2n2 + (6.0*SQRT2_INV*WIGNER_222_112)*c21*c2n1;
    rFp3Px += tMul1*aCnlmPx[tIdx+2] + tMul2*aCnlmPx[tIdx-2];
    rFp3Py += tMul1*aCnlmPy[tIdx+2] + tMul2*aCnlmPy[tIdx-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx+2] + tMul2*aCnlmPz[tIdx-2];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_112_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx2 = 2*2+2;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_112_000*c10*c10 - WIGNER_112_110*(c11*c11 + c1n1*c1n1);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_112_000)*c10*c20 - (2.0*WIGNER_112_011)*(c11*c21 + c1n1*c2n1);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    
    double tMul1 = (-2.0*WIGNER_112_110)*c20*c11  - (2.0*WIGNER_112_011)*c10*c21  + (2.0*SQRT2_INV*WIGNER_112_112)*c22*c11  + (2.0*SQRT2_INV*WIGNER_112_112)*c1n1*c2n2;
    double tMul2 = (-2.0*WIGNER_112_110)*c20*c1n1 - (2.0*WIGNER_112_011)*c10*c2n1 - (2.0*SQRT2_INV*WIGNER_112_112)*c22*c1n1 + (2.0*SQRT2_INV*WIGNER_112_112)*c11*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-2.0*WIGNER_112_011)*c10*c11;
    tMul2 = (-2.0*WIGNER_112_011)*c10*c1n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (SQRT2_INV*WIGNER_112_112)*(c11*c11 - c1n1*c1n1);
    tMul2 = (2.0*SQRT2_INV*WIGNER_112_112)*c11*c1n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_233_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx3 = 3*3+3;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_233_000*c30*c30 - WIGNER_233_011*(c31*c31 + c3n1*c3n1) + WIGNER_233_022*(c32*c32 + c3n2*c3n2) - WIGNER_233_033*(c33*c33 + c3n3*c3n3);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_233_000)*c20*c30 - (2.0*WIGNER_233_110)*(c21*c31 + c2n1*c3n1) + (2.0*WIGNER_233_220)*(c22*c32 + c2n2*c3n2);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-2.0*WIGNER_233_110) * c30*c31  + (2.0*SQRT2_INV*WIGNER_233_112)*(c31*c32 + c3n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_123)*(c32*c33 + c3n2*c3n3);
    double tMul2 = (-2.0*WIGNER_233_110) * c30*c3n1 + (2.0*SQRT2_INV*WIGNER_233_112)*(c31*c3n2 - c3n1*c32) - (2.0*SQRT2_INV*WIGNER_233_123)*(c32*c3n3 - c3n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_233_220) * c30*c32  - (2.0*SQRT2_INV*WIGNER_233_213)*(c31*c33 + c3n1*c3n3) + (SQRT2_INV*WIGNER_233_211)*(c31*c31 - c3n1*c3n1);
    tMul2 = (2.0*WIGNER_233_220) * c30*c3n2 - (2.0*SQRT2_INV*WIGNER_233_213)*(c31*c3n3 - c3n1*c33) + (2.0*SQRT2_INV*WIGNER_233_211)*c31*c3n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_233_011)*c20*c31  - (2.0*WIGNER_233_110)*c30*c21  + (2.0*SQRT2_INV*WIGNER_233_211)*c22*c31  + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c32 + c2n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c33 + c2n2*c3n3) + (2.0*SQRT2_INV*WIGNER_233_211)*c2n2*c3n1;
    tMul2 = (-2.0*WIGNER_233_011)*c20*c3n1 - (2.0*WIGNER_233_110)*c30*c2n1 - (2.0*SQRT2_INV*WIGNER_233_211)*c22*c3n1 + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c3n2 - c2n1*c32) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c3n3 - c2n2*c33) + (2.0*SQRT2_INV*WIGNER_233_211)*c31*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = (2.0*WIGNER_233_022)*c20*c32  + (2.0*WIGNER_233_220)*c30*c22  + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c31 - c2n1*c3n1) - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c33 + c2n1*c3n3);
    tMul2 = (2.0*WIGNER_233_022)*c20*c3n2 + (2.0*WIGNER_233_220)*c30*c2n2 + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c3n1 + c2n1*c31) - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c3n3 - c2n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-2.0*WIGNER_233_033)*c20*c33  - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c32 - c2n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c31 - c2n2*c3n1);
    tMul2 = (-2.0*WIGNER_233_033)*c20*c3n3 - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c3n2 + c2n1*c32) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c3n1 + c2n2*c31);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_123_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx2 = 2*2+2;
    const jint tIdx3 = 3*3+3;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_123_000*c20*c30 - WIGNER_123_011*(c21*c31 + c2n1*c3n1) + WIGNER_123_022*(c22*c32 + c2n2*c3n2);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    tMul = WIGNER_123_000*c10*c30 - WIGNER_123_101*(c11*c31 + c1n1*c3n1);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = WIGNER_123_000*c10*c20 - WIGNER_123_110*(c11*c21 + c1n1*c2n1);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-WIGNER_123_101)*c20*c31  - WIGNER_123_110*c30*c21  + (SQRT2_INV*WIGNER_123_112)*(c21*c32 + c2n1*c3n2) + (SQRT2_INV*WIGNER_123_121)*(c22*c31 + c2n2*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c22*c33 + c2n2*c3n3);
    double tMul2 = (-WIGNER_123_101)*c20*c3n1 - WIGNER_123_110*c30*c2n1 + (SQRT2_INV*WIGNER_123_112)*(c21*c3n2 - c2n1*c32) + (SQRT2_INV*WIGNER_123_121)*(c2n2*c31 - c22*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c22*c3n3 - c2n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-WIGNER_123_011)*c10*c31  - WIGNER_123_110*c30*c11  + (SQRT2_INV*WIGNER_123_112)*(c11*c32 + c1n1*c3n2);
    tMul2 = (-WIGNER_123_011)*c10*c3n1 - WIGNER_123_110*c30*c1n1 + (SQRT2_INV*WIGNER_123_112)*(c11*c3n2 - c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = WIGNER_123_022*c10*c32  + (SQRT2_INV*WIGNER_123_121)*(c11*c31 - c1n1*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c11*c33 + c1n1*c3n3);
    tMul2 = WIGNER_123_022*c10*c3n2 + (SQRT2_INV*WIGNER_123_121)*(c11*c3n1 + c1n1*c31) - (SQRT2_INV*WIGNER_123_123)*(c11*c3n3 - c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-WIGNER_123_011)*c10*c21  - WIGNER_123_101*c20*c11  + (SQRT2_INV*WIGNER_123_121)*(c11*c22 + c1n1*c2n2);
    tMul2 = (-WIGNER_123_011)*c10*c2n1 - WIGNER_123_101*c20*c1n1 + (SQRT2_INV*WIGNER_123_121)*(c11*c2n2 - c1n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = WIGNER_123_022*c10*c22  + (SQRT2_INV*WIGNER_123_112)*(c11*c21 - c1n1*c2n1);
    tMul2 = WIGNER_123_022*c10*c2n2 + (SQRT2_INV*WIGNER_123_112)*(c11*c2n1 + c1n1*c21);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-SQRT2_INV*WIGNER_123_123)*(c11*c22 - c1n1*c2n2);
    tMul2 = (-SQRT2_INV*WIGNER_123_123)*(c11*c2n2 + c1n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_444_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                             double *rFpPx, double *rFpPy, double *rFpPz,
                             double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                             double aWt, jint aIdxFP) {
    const jint tIdx = 4*4+4;
    const double c40  = aCnlm[tIdx  ];
    const double c41  = aCnlm[tIdx+1];
    const double c4n1 = aCnlm[tIdx-1];
    const double c42  = aCnlm[tIdx+2];
    const double c4n2 = aCnlm[tIdx-2];
    const double c43  = aCnlm[tIdx+3];
    const double c4n3 = aCnlm[tIdx-3];
    const double c44  = aCnlm[tIdx+4];
    const double c4n4 = aCnlm[tIdx-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = (3.0*WIGNER_444_000)*c40*c40 - (3.0*WIGNER_444_011)*(c41*c41 + c4n1*c4n1) + (3.0*WIGNER_444_022)*(c42*c42 + c4n2*c4n2) - (3.0*WIGNER_444_033)*(c43*c43 + c4n3*c4n3) + (3.0*WIGNER_444_044)*(c44*c44 + c4n4*c4n4);
    rFp3Px += tMul*aCnlmPx[tIdx];
    rFp3Py += tMul*aCnlmPy[tIdx];
    rFp3Pz += tMul*aCnlmPz[tIdx];
    
    double tMul1 = (-6.0*WIGNER_444_011)*c40*c41  + (6.0*SQRT2_INV*WIGNER_444_112)*c42*c41  + (6.0*SQRT2_INV*WIGNER_444_112)*c4n1*c4n2 - (6.0*SQRT2_INV*WIGNER_444_123)*(c42*c43 + c4n2*c4n3) + (6.0*SQRT2_INV*WIGNER_444_134)*(c43*c44 + c4n3*c4n4);
    double tMul2 = (-6.0*WIGNER_444_011)*c40*c4n1 - (6.0*SQRT2_INV*WIGNER_444_112)*c42*c4n1 + (6.0*SQRT2_INV*WIGNER_444_112)*c41*c4n2  - (6.0*SQRT2_INV*WIGNER_444_123)*(c42*c4n3 - c4n2*c43) + (6.0*SQRT2_INV*WIGNER_444_134)*(c43*c4n4 - c4n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx+1] + tMul2*aCnlmPx[tIdx-1];
    rFp3Py += tMul1*aCnlmPy[tIdx+1] + tMul2*aCnlmPy[tIdx-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx+1] + tMul2*aCnlmPz[tIdx-1];
    tMul1 = (6.0*WIGNER_444_022)*c40*c42  + (6.0*SQRT2_INV*WIGNER_444_224)*c44*c42  - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c43 + c4n1*c4n3) + (6.0*SQRT2_INV*WIGNER_444_224)*c4n2*c4n4 + (3.0*SQRT2_INV*WIGNER_444_112)*(c41*c41 - c4n1*c4n1);
    tMul2 = (6.0*WIGNER_444_022)*c40*c4n2 - (6.0*SQRT2_INV*WIGNER_444_224)*c44*c4n2 - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c4n3 - c4n1*c43) + (6.0*SQRT2_INV*WIGNER_444_224)*c42*c4n4  + (6.0*SQRT2_INV*WIGNER_444_112)*c41*c4n1;
    rFp3Px += tMul1*aCnlmPx[tIdx+2] + tMul2*aCnlmPx[tIdx-2];
    rFp3Py += tMul1*aCnlmPy[tIdx+2] + tMul2*aCnlmPy[tIdx-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx+2] + tMul2*aCnlmPz[tIdx-2];
    tMul1 = (-6.0*WIGNER_444_033)*c40*c43  - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c42 - c4n1*c4n2) + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c44 + c4n1*c4n4);
    tMul2 = (-6.0*WIGNER_444_033)*c40*c4n3 - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c4n2 + c4n1*c42) + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c4n4 - c4n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx+3] + tMul2*aCnlmPx[tIdx-3];
    rFp3Py += tMul1*aCnlmPy[tIdx+3] + tMul2*aCnlmPy[tIdx-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx+3] + tMul2*aCnlmPz[tIdx-3];
    tMul1 = (6.0*WIGNER_444_044)*c40*c44  + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c43 - c4n1*c4n3) + (3.0*SQRT2_INV*WIGNER_444_224)*(c42*c42 - c4n2*c4n2);
    tMul2 = (6.0*WIGNER_444_044)*c40*c4n4 + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c4n3 + c4n1*c43) + (6.0*SQRT2_INV*WIGNER_444_224)*c42*c4n2;
    rFp3Px += tMul1*aCnlmPx[tIdx+4] + tMul2*aCnlmPx[tIdx-4];
    rFp3Py += tMul1*aCnlmPy[tIdx+4] + tMul2*aCnlmPy[tIdx-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx+4] + tMul2*aCnlmPz[tIdx-4];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_224_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx4 = 4*4+4;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_224_000*c20*c20 - WIGNER_224_110*(c21*c21 + c2n1*c2n1) + WIGNER_224_220*(c22*c22 + c2n2*c2n2);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = (2.0*WIGNER_224_000)*c20*c40 - (2.0*WIGNER_224_011)*(c21*c41 + c2n1*c4n1) + (2.0*WIGNER_224_022)*(c22*c42 + c2n2*c4n2);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    
    double tMul1 = (-2.0*WIGNER_224_110)*c40*c21  - (2.0*WIGNER_224_011)*c20*c41  + (2.0*SQRT2_INV*WIGNER_224_112)*c42*c21  + (2.0*SQRT2_INV*WIGNER_224_112)*c2n1*c4n2 + (2.0*SQRT2_INV*WIGNER_224_121)*(c22*c41 + c2n2*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c22*c43 + c2n2*c4n3);
    double tMul2 = (-2.0*WIGNER_224_110)*c40*c2n1 - (2.0*WIGNER_224_011)*c20*c4n1 - (2.0*SQRT2_INV*WIGNER_224_112)*c42*c2n1 + (2.0*SQRT2_INV*WIGNER_224_112)*c21*c4n2  + (2.0*SQRT2_INV*WIGNER_224_121)*(c2n2*c41 - c22*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c22*c4n3 - c2n2*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_224_220)*c40*c22  + (2.0*WIGNER_224_022)*c20*c42  + (2.0*SQRT2_INV*WIGNER_224_224)*c44*c22  + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c41 - c2n1*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c21*c43 + c2n1*c4n3) + (2.0*SQRT2_INV*WIGNER_224_224)*c2n2*c4n4;
    tMul2 = (2.0*WIGNER_224_220)*c40*c2n2 + (2.0*WIGNER_224_022)*c20*c4n2 - (2.0*SQRT2_INV*WIGNER_224_224)*c44*c2n2 + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c4n1 + c2n1*c41) - (2.0*SQRT2_INV*WIGNER_224_123)*(c21*c4n3 - c2n1*c43) + (2.0*SQRT2_INV*WIGNER_224_224)*c22*c4n4;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_224_011)*c20*c21  + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c22 + c2n1*c2n2);
    tMul2 = (-2.0*WIGNER_224_011)*c20*c2n1 + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c2n2 - c2n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_224_022)*c20*c22  + (SQRT2_INV*WIGNER_224_112)*(c21*c21 - c2n1*c2n1);
    tMul2 = (2.0*WIGNER_224_022)*c20*c2n2 + (2.0*SQRT2_INV*WIGNER_224_112)*c21*c2n1;
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*SQRT2_INV*WIGNER_224_123)*(c21*c22 - c2n1*c2n2);
    tMul2 = (-2.0*SQRT2_INV*WIGNER_224_123)*(c21*c2n2 + c2n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*SQRT2_INV*WIGNER_224_224)*c22*c2n2;
    tMul2 = (SQRT2_INV*WIGNER_224_224)*(c22*c22 - c2n2*c2n2);
    rFp3Px += tMul1*aCnlmPx[tIdx4-4] + tMul2*aCnlmPx[tIdx4+4];
    rFp3Py += tMul1*aCnlmPy[tIdx4-4] + tMul2*aCnlmPy[tIdx4+4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4-4] + tMul2*aCnlmPz[tIdx4+4];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_334_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx3 = 3*3+3;
    const jint tIdx4 = 4*4+4;
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_334_000*c30*c30 - WIGNER_334_110*(c31*c31 + c3n1*c3n1) + WIGNER_334_220*(c32*c32 + c3n2*c3n2) - WIGNER_334_330*(c33*c33 + c3n3*c3n3);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = (2.0*WIGNER_334_000)*c30*c40 - (2.0*WIGNER_334_011)*(c31*c41 + c3n1*c4n1) + (2.0*WIGNER_334_022)*(c32*c42 + c3n2*c4n2) - (2.0*WIGNER_334_033)*(c33*c43 + c3n3*c4n3);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-2.0*WIGNER_334_110)*c40*c31  - (2.0*WIGNER_334_011)*c30*c41  + (2.0*SQRT2_INV*WIGNER_334_112)*c42*c31  + (2.0*SQRT2_INV*WIGNER_334_112)*c3n1*c4n2 + (2.0*SQRT2_INV*WIGNER_334_121)*(c32*c41 + c3n2*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c32*c43 + c3n2*c4n3) - (2.0*SQRT2_INV*WIGNER_334_132)*(c33*c42 + c3n3*c4n2) + (2.0*SQRT2_INV*WIGNER_334_134)*(c33*c44 + c3n3*c4n4);
    double tMul2 = (-2.0*WIGNER_334_110)*c40*c3n1 - (2.0*WIGNER_334_011)*c30*c4n1 - (2.0*SQRT2_INV*WIGNER_334_112)*c42*c3n1 + (2.0*SQRT2_INV*WIGNER_334_112)*c31*c4n2  + (2.0*SQRT2_INV*WIGNER_334_121)*(c3n2*c41 - c32*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c32*c4n3 - c3n2*c43) - (2.0*SQRT2_INV*WIGNER_334_132)*(c3n3*c42 - c33*c4n2) + (2.0*SQRT2_INV*WIGNER_334_134)*(c33*c4n4 - c3n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = (2.0*WIGNER_334_220)*c40*c32  + (2.0*WIGNER_334_022)*c30*c42  + (2.0*SQRT2_INV*WIGNER_334_224)*c44*c32  + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c41 - c3n1*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c43 + c3n1*c4n3) + (2.0*SQRT2_INV*WIGNER_334_224)*c3n2*c4n4 - (2.0*SQRT2_INV*WIGNER_334_231)*(c33*c41 + c3n3*c4n1);
    tMul2 = (2.0*WIGNER_334_220)*c40*c3n2 + (2.0*WIGNER_334_022)*c30*c4n2 - (2.0*SQRT2_INV*WIGNER_334_224)*c44*c3n2 + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c4n1 + c3n1*c41) - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c4n3 - c3n1*c43) + (2.0*SQRT2_INV*WIGNER_334_224)*c32*c4n4  - (2.0*SQRT2_INV*WIGNER_334_231)*(c3n3*c41 - c33*c4n1);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-2.0*WIGNER_334_330)*c40*c33  - (2.0*WIGNER_334_033)*c30*c43  - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c42 - c3n1*c4n2) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c41 - c3n2*c4n1) + (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c44 + c3n1*c4n4);
    tMul2 = (-2.0*WIGNER_334_330)*c40*c3n3 - (2.0*WIGNER_334_033)*c30*c4n3 - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c4n2 + c3n1*c42) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c4n1 + c3n2*c41) + (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c4n4 - c3n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    tMul1 = (-2.0*WIGNER_334_011)*c30*c31  + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c32 + c3n1*c3n2) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c33 + c3n2*c3n3);
    tMul2 = (-2.0*WIGNER_334_011)*c30*c3n1 + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c3n2 - c3n1*c32) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c3n3 - c3n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_334_022)*c30*c32  - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c33 + c3n1*c3n3) + (SQRT2_INV*WIGNER_334_112)*(c31*c31 - c3n1*c3n1);
    tMul2 = (2.0*WIGNER_334_022)*c30*c3n2 - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c3n3 - c3n1*c33) + (2.0*SQRT2_INV*WIGNER_334_112)*c31*c3n1;
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*WIGNER_334_033)*c30*c33  - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c32 - c3n1*c3n2);
    tMul2 = (-2.0*WIGNER_334_033)*c30*c3n3 - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c3n2 + c3n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c33 - c3n1*c3n3) + (SQRT2_INV*WIGNER_334_224)*(c32*c32 - c3n2*c3n2);
    tMul2 = (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c3n3 + c3n1*c33) + (2.0*SQRT2_INV*WIGNER_334_224)*c32*c3n2;
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_244_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx4 = 4*4+4;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_244_000*c40*c40 - WIGNER_244_011*(c41*c41 + c4n1*c4n1) + WIGNER_244_022*(c42*c42 + c4n2*c4n2) - WIGNER_244_033*(c43*c43 + c4n3*c4n3) + WIGNER_244_044*(c44*c44 + c4n4*c4n4);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_244_000)*c20*c40 - (2.0*WIGNER_244_110)*(c21*c41 + c2n1*c4n1) + (2.0*WIGNER_244_220)*(c22*c42 + c2n2*c4n2);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    
    double tMul1 = (-2.0*WIGNER_244_110)*c40*c41  + (2.0*SQRT2_INV*WIGNER_244_112)*(c41*c42 + c4n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_123)*(c42*c43 + c4n2*c4n3) + (2.0*SQRT2_INV*WIGNER_244_134)*(c43*c44 + c4n3*c4n4);
    double tMul2 = (-2.0*WIGNER_244_110)*c40*c4n1 + (2.0*SQRT2_INV*WIGNER_244_112)*(c41*c4n2 - c4n1*c42) - (2.0*SQRT2_INV*WIGNER_244_123)*(c42*c4n3 - c4n2*c43) + (2.0*SQRT2_INV*WIGNER_244_134)*(c43*c4n4 - c4n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_244_220)*c40*c42  + (2.0*SQRT2_INV*WIGNER_244_224)*(c42*c44 + c4n2*c4n4) - (2.0*SQRT2_INV*WIGNER_244_213)*(c41*c43 + c4n1*c4n3) + (SQRT2_INV*WIGNER_244_211)*(c41*c41 - c4n1*c4n1);
    tMul2 = (2.0*WIGNER_244_220)*c40*c4n2 + (2.0*SQRT2_INV*WIGNER_244_224)*(c42*c4n4 - c4n2*c44) - (2.0*SQRT2_INV*WIGNER_244_213)*(c41*c4n3 - c4n1*c43) + (2.0*SQRT2_INV*WIGNER_244_211)*c41*c4n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_244_011)*c20*c41  - (2.0*WIGNER_244_110)*c40*c21  + (2.0*SQRT2_INV*WIGNER_244_211)*c22*c41  + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c42 + c2n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c43 + c2n2*c4n3) + (2.0*SQRT2_INV*WIGNER_244_211)*c2n2*c4n1;
    tMul2 = (-2.0*WIGNER_244_011)*c20*c4n1 - (2.0*WIGNER_244_110)*c40*c2n1 - (2.0*SQRT2_INV*WIGNER_244_211)*c22*c4n1 + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c4n2 - c2n1*c42) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c4n3 - c2n2*c43) + (2.0*SQRT2_INV*WIGNER_244_211)*c41*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_244_022)*c20*c42  + (2.0*WIGNER_244_220)*c40*c22  + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c41 - c2n1*c4n1) + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c44 + c2n2*c4n4) - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c43 + c2n1*c4n3);
    tMul2 = (2.0*WIGNER_244_022)*c20*c4n2 + (2.0*WIGNER_244_220)*c40*c2n2 + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c4n1 + c2n1*c41) + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c4n4 - c2n2*c44) - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c4n3 - c2n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*WIGNER_244_033)*c20*c43  - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c42 - c2n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c41 - c2n2*c4n1) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c44 + c2n1*c4n4);
    tMul2 = (-2.0*WIGNER_244_033)*c20*c4n3 - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c4n2 + c2n1*c42) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c4n1 + c2n2*c41) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c4n4 - c2n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*WIGNER_244_044)*c20*c44  + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c42 - c2n2*c4n2) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c43 - c2n1*c4n3);
    tMul2 = (2.0*WIGNER_244_044)*c20*c4n4 + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c4n2 + c2n2*c42) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c4n3 + c2n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_134_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx3 = 3*3+3;
    const jint tIdx4 = 4*4+4;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_134_000*c30*c40 - WIGNER_134_011*(c31*c41 + c3n1*c4n1) + WIGNER_134_022*(c32*c42 + c3n2*c4n2) - WIGNER_134_033*(c33*c43 + c3n3*c4n3);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    tMul = WIGNER_134_000*c10*c30 - WIGNER_134_110*(c11*c31 + c1n1*c3n1);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = WIGNER_134_000*c10*c40 - WIGNER_134_101*(c11*c41 + c1n1*c4n1);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-WIGNER_134_110)*c40*c31  - WIGNER_134_101*c30*c41  + (SQRT2_INV*WIGNER_134_112)*(c31*c42 + c3n1*c4n2) + (SQRT2_INV*WIGNER_134_121)*(c32*c41 + c3n2*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c32*c43 + c3n2*c4n3) - (SQRT2_INV*WIGNER_134_132)*(c33*c42 + c3n3*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c33*c44 + c3n3*c4n4);
    double tMul2 = (-WIGNER_134_110)*c40*c3n1 - WIGNER_134_101*c30*c4n1 + (SQRT2_INV*WIGNER_134_112)*(c31*c4n2 - c3n1*c42) + (SQRT2_INV*WIGNER_134_121)*(c3n2*c41 - c32*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c32*c4n3 - c3n2*c43) - (SQRT2_INV*WIGNER_134_132)*(c3n3*c42 - c33*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c33*c4n4 - c3n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-WIGNER_134_011)*c10*c41  - WIGNER_134_110*c40*c11  + (SQRT2_INV*WIGNER_134_112)*(c11*c42 + c1n1*c4n2);
    tMul2 = (-WIGNER_134_011)*c10*c4n1 - WIGNER_134_110*c40*c1n1 + (SQRT2_INV*WIGNER_134_112)*(c11*c4n2 - c1n1*c42);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = WIGNER_134_022*c10*c42  + (SQRT2_INV*WIGNER_134_121)*(c11*c41 - c1n1*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c11*c43 + c1n1*c4n3);
    tMul2 = WIGNER_134_022*c10*c4n2 + (SQRT2_INV*WIGNER_134_121)*(c11*c4n1 + c1n1*c41) - (SQRT2_INV*WIGNER_134_123)*(c11*c4n3 - c1n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-WIGNER_134_033)*c10*c43  - (SQRT2_INV*WIGNER_134_132)*(c11*c42 - c1n1*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c11*c44 + c1n1*c4n4);
    tMul2 = (-WIGNER_134_033)*c10*c4n3 - (SQRT2_INV*WIGNER_134_132)*(c11*c4n2 + c1n1*c42) + (SQRT2_INV*WIGNER_134_134)*(c11*c4n4 - c1n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    tMul1 = (-WIGNER_134_011)*c10*c31  - WIGNER_134_101*c30*c11  + (SQRT2_INV*WIGNER_134_121)*(c11*c32 + c1n1*c3n2);
    tMul2 = (-WIGNER_134_011)*c10*c3n1 - WIGNER_134_101*c30*c1n1 + (SQRT2_INV*WIGNER_134_121)*(c11*c3n2 - c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = WIGNER_134_022*c10*c32  + (SQRT2_INV*WIGNER_134_112)*(c11*c31 - c1n1*c3n1) - (SQRT2_INV*WIGNER_134_132)*(c11*c33 + c1n1*c3n3);
    tMul2 = WIGNER_134_022*c10*c3n2 + (SQRT2_INV*WIGNER_134_112)*(c11*c3n1 + c1n1*c31) - (SQRT2_INV*WIGNER_134_132)*(c11*c3n3 - c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-WIGNER_134_033)*c10*c33  - (SQRT2_INV*WIGNER_134_123)*(c11*c32 - c1n1*c3n2);
    tMul2 = (-WIGNER_134_033)*c10*c3n3 - (SQRT2_INV*WIGNER_134_123)*(c11*c3n2 + c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (SQRT2_INV*WIGNER_134_134)*(c11*c33 - c1n1*c3n3);
    tMul2 = (SQRT2_INV*WIGNER_134_134)*(c11*c3n3 + c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    putFpPxyz_(rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt*rFp3Px, aWt*rFp3Py, aWt*rFp3Pz, aIdxFP);
}
static inline void calL3_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                          double *rFpPx, double *rFpPy, double *rFpPz,
                          double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                          double aWt, jint aLMax, jint aL3Max, jboolean aL3Cross) {
    if (aL3Max <= 1) return;
    jint tIdxFP = aLMax+1;
    calL3_222_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
    ++tIdxFP;
    if (aL3Cross) {
        calL3_112_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
    }
    if (aL3Max == 2) return;
    if (aL3Cross) {
        calL3_233_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
        calL3_123_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
    }
    if (aL3Max == 3) return;
    calL3_444_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
    ++tIdxFP;
    if (aL3Cross) {
        calL3_224_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
        calL3_334_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
        calL3_244_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
        calL3_134_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, rFpPxCross, rFpPyCross, rFpPzCross, aWt, tIdxFP);
        ++tIdxFP;
    }
}
static inline void cnlm2fpPxyz(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                               double *rFpPx, double *rFpPy, double *rFpPz,
                               double *rFpPxCross, double *rFpPyCross, double *rFpPzCross,
                               double aWt, jint aLMax, jint aL3Max, jboolean aL3Cross) {
    calL2_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz,
           rFpPx, rFpPy, rFpPz,
           rFpPxCross, rFpPyCross, rFpPzCross,
           aWt, aLMax);
    calL3_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz,
           rFpPx, rFpPy, rFpPz,
           rFpPxCross, rFpPyCross, rFpPzCross,
           aWt, aLMax, aL3Max, aL3Cross);
}


JNIEXPORT void JNICALL Java_jsex_nnap_basis_SphericalChebyshevNative_evalPartial1(JNIEnv *aEnv, jclass aClazz,
        jdoubleArray aNlDx, jdoubleArray aNlDy, jdoubleArray aNlDz, jintArray aNlType, jint aNN,
        jdoubleArray aNlRn, jdoubleArray rRnPx, jdoubleArray rRnPy, jdoubleArray rRnPz,
        jdoubleArray aNlY, jdoubleArray rYPtheta, jdoubleArray rYPphi, jdoubleArray rYPx, jdoubleArray rYPy, jdoubleArray rYPz,
        jdoubleArray aCnlm, jdoubleArray rCnlmPx, jdoubleArray rCnlmPy, jdoubleArray rCnlmPz,
        jdoubleArray rFingerPrintPx, jdoubleArray rFingerPrintPy, jdoubleArray rFingerPrintPz,
        jdoubleArray rFingerPrintPxCross, jdoubleArray rFingerPrintPyCross, jdoubleArray rFingerPrintPzCross,
        jint aTypeNum, jdouble aRCut, jint aNMax, jint aLMax, jint aL3Max, jboolean aL3Cross) {
    // java array init
#ifdef __cplusplus
    double *tNlDx = (double *)aEnv->GetPrimitiveArrayCritical(aNlDx, NULL);
    double *tNlDy = (double *)aEnv->GetPrimitiveArrayCritical(aNlDy, NULL);
    double *tNlDz = (double *)aEnv->GetPrimitiveArrayCritical(aNlDz, NULL);
    jint *tNlType = (jint *)aEnv->GetPrimitiveArrayCritical(aNlType, NULL);
    double *tNlRn = (double *)aEnv->GetPrimitiveArrayCritical(aNlRn, NULL);
    double *tRnPx = (double *)aEnv->GetPrimitiveArrayCritical(rRnPx, NULL);
    double *tRnPy = (double *)aEnv->GetPrimitiveArrayCritical(rRnPy, NULL);
    double *tRnPz = (double *)aEnv->GetPrimitiveArrayCritical(rRnPz, NULL);
    double *tNlY = (double *)aEnv->GetPrimitiveArrayCritical(aNlY, NULL);
    double *tYPtheta = (double *)aEnv->GetPrimitiveArrayCritical(rYPtheta, NULL);
    double *tYPphi = (double *)aEnv->GetPrimitiveArrayCritical(rYPphi, NULL);
    double *tYPx = (double *)aEnv->GetPrimitiveArrayCritical(rYPx, NULL);
    double *tYPy = (double *)aEnv->GetPrimitiveArrayCritical(rYPy, NULL);
    double *tYPz = (double *)aEnv->GetPrimitiveArrayCritical(rYPz, NULL);
    double *tCnlm = (double *)aEnv->GetPrimitiveArrayCritical(aCnlm, NULL);
    double *tCnlmPx = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPx, NULL);
    double *tCnlmPy = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPy, NULL);
    double *tCnlmPz = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPz, NULL);
    double *tFingerPrintPx = (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPx, NULL);
    double *tFingerPrintPy = (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPy, NULL);
    double *tFingerPrintPz = (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPz, NULL);
    double *tFingerPrintPxCross = rFingerPrintPxCross==NULL ? NULL : (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPxCross, NULL);
    double *tFingerPrintPyCross = rFingerPrintPyCross==NULL ? NULL : (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPyCross, NULL);
    double *tFingerPrintPzCross = rFingerPrintPzCross==NULL ? NULL : (double *)aEnv->GetPrimitiveArrayCritical(rFingerPrintPzCross, NULL);
#else
    double *tNlDx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDx, NULL);
    double *tNlDy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDy, NULL);
    double *tNlDz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDz, NULL);
    jint *tNlType = (jint *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlType, NULL);
    double *tNlRn = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlRn, NULL);
    double *tRnPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPx, NULL);
    double *tRnPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPy, NULL);
    double *tRnPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPz, NULL);
    double *tNlY = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlY, NULL);
    double *tYPtheta = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPtheta, NULL);
    double *tYPphi = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPphi, NULL);
    double *tYPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPx, NULL);
    double *tYPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPy, NULL);
    double *tYPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPz, NULL);
    double *tCnlm = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aCnlm, NULL);
    double *tCnlmPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPx, NULL);
    double *tCnlmPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPy, NULL);
    double *tCnlmPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPz, NULL);
    double *tFingerPrintPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPx, NULL);
    double *tFingerPrintPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPy, NULL);
    double *tFingerPrintPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPz, NULL);
    double *tFingerPrintPxCross = rFingerPrintPxCross==NULL ? NULL : (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPxCross, NULL);
    double *tFingerPrintPyCross = rFingerPrintPyCross==NULL ? NULL : (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPyCross, NULL);
    double *tFingerPrintPzCross = rFingerPrintPzCross==NULL ? NULL : (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFingerPrintPzCross, NULL);
#endif
    // const init
    const jint tSizeN = aTypeNum>1 ? aNMax+aNMax+2 : aNMax+1;
    const jint tSizeL = aLMax+1 + (aL3Cross?L3NCOLS:L3NCOLS_NOCROSS)[aL3Max];
    const jint tLMax = aLMax>aL3Max ? aLMax : aL3Max;
    const jint tLMAll = (tLMax+1)*(tLMax+1);
    // loop for neighbor
    for (jint j = 0; j < aNN; ++j) {
        double dx = tNlDx[j], dy = tNlDy[j], dz = tNlDz[j];
        double dis = sqrt(dx*dx + dy*dy + dz*dz);
        // cal weight of type
        jint type = tNlType[j];
        double wt = ((type&1)==1) ? type : -type;
        // cal fc
        double fcMul = 1.0 - pow2(dis/aRCut);
        double fcMul3 = pow3(fcMul);
        double fc = fcMul3 * fcMul;
        double fcPMul = 8.0 * fcMul3 / (aRCut*aRCut);
        double fcPx = dx * fcPMul;
        double fcPy = dy * fcPMul;
        double fcPz = dz * fcPMul;
        // cal Rn
        double *tRn = tNlRn + j*(aNMax+1);
        calRnPxyz(tRnPx, tRnPy, tRnPz, aNMax,
                  dis, aRCut, dx, dy, dz);
        // cal Ylm
        double dxy = hypot(dx, dy);
        double cosTheta = dz / dis;
        double sinTheta = dxy / dis;
        double cosPhi;
        double sinPhi;
        jboolean dxyCloseZero = numericEqual(dxy, 0.0);
        if (dxyCloseZero) {
            cosPhi = 1.0;
            sinPhi = 0.0;
        } else {
            cosPhi = dx / dxy;
            sinPhi = dy / dxy;
        }
        double *tY = tNlY + j*tLMAll;
        if (dxyCloseZero) {
            // fix singularity
            for (jint k = 0; k < tLMAll; ++k) tYPphi[k] = 0.0;
        }
        for (jint tL = 0; tL <= tLMax; ++tL) {
            if (!dxyCloseZero) {
                calYPphi(tYPphi, tY, tL);
            }
            calYPtheta(cosPhi, sinPhi, tYPtheta, tY, tL);
        }
        // conert to Pxyz
        calYPxyz(cosTheta, sinTheta, cosPhi, sinPhi, dis, dxy, dxyCloseZero,
                 tYPx, tYPy, tYPz,
                 tYPtheta, tYPphi, tLMAll);
        // cal cnlmPxyz
        for (jint tN=0, tShift=0, tShiftFP=0; tN <= aNMax; ++tN, tShift+=tLMAll, tShiftFP+=tSizeL) {
            // cal cnlmPxyz first
            calCnlmPxyz(tCnlmPx, tCnlmPy, tCnlmPz,
                        tY, tYPx, tYPy, tYPz,
                        fc, fcPx, fcPy, fcPz,
                        tRn[tN], tRnPx[tN], tRnPy[tN], tRnPz[tN],
                        tLMAll);
            // accumulate to fp
            jint tShiftFPC = tShiftFP + j*(tSizeN*tSizeL);
            cnlm2fpPxyz(tCnlm+tShift, tCnlmPx, tCnlmPy, tCnlmPz,
                        tFingerPrintPx+tShiftFP, tFingerPrintPy+tShiftFP, tFingerPrintPz+tShiftFP,
                        tFingerPrintPxCross==NULL ? NULL : (tFingerPrintPxCross+tShiftFPC),
                        tFingerPrintPyCross==NULL ? NULL : (tFingerPrintPyCross+tShiftFPC),
                        tFingerPrintPzCross==NULL ? NULL : (tFingerPrintPzCross+tShiftFPC),
                        1.0, aLMax, aL3Max, aL3Cross);
            if (aTypeNum > 1) {
                jint tShift0 = tShift + (aNMax+1)*tLMAll;
                jint tShiftFP0 = tShiftFP + (aNMax+1)*tSizeL;
                tShiftFPC = tShiftFP0 + j*(tSizeN*tSizeL);
                cnlm2fpPxyz(tCnlm+tShift0, tCnlmPx, tCnlmPy, tCnlmPz,
                            tFingerPrintPx+tShiftFP0, tFingerPrintPy+tShiftFP0, tFingerPrintPz+tShiftFP0,
                            tFingerPrintPxCross==NULL ? NULL : (tFingerPrintPxCross+tShiftFPC),
                            tFingerPrintPyCross==NULL ? NULL : (tFingerPrintPyCross+tShiftFPC),
                            tFingerPrintPzCross==NULL ? NULL : (tFingerPrintPzCross+tShiftFPC),
                            wt, aLMax, aL3Max, aL3Cross);
            }
        }
    }
    // release java array
#ifdef __cplusplus
    aEnv->ReleasePrimitiveArrayCritical(aNlDx, tNlDx, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDy, tNlDy, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDz, tNlDz, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlType, tNlType, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlRn, tNlRn, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(rRnPx, tRnPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rRnPy, tRnPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rRnPz, tRnPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(aNlY, tNlY, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(rYPtheta, tYPtheta, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPphi, tYPphi, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPx, tYPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPy, tYPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPz, tYPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(aCnlm, tCnlm, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPx, tCnlmPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPy, tCnlmPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPz, tCnlmPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPx, tFingerPrintPx, 0);
    aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPy, tFingerPrintPy, 0);
    aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPz, tFingerPrintPz, 0);
    if (rFingerPrintPxCross != NULL) aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPxCross, tFingerPrintPxCross, 0);
    if (rFingerPrintPyCross != NULL) aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPyCross, tFingerPrintPyCross, 0);
    if (rFingerPrintPzCross != NULL) aEnv->ReleasePrimitiveArrayCritical(rFingerPrintPzCross, tFingerPrintPzCross, 0);
#else
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDx, tNlDx, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDy, tNlDy, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDz, tNlDz, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlType, tNlType, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlRn, tNlRn, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPx, tRnPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPy, tRnPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPz, tRnPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlY, tNlY, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPtheta, tYPtheta, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPphi, tYPphi, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPx, tYPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPy, tYPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPz, tYPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aCnlm, tCnlm, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPx, tCnlmPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPy, tCnlmPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPz, tCnlmPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPx, tFingerPrintPx, 0);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPy, tFingerPrintPy, 0);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPz, tFingerPrintPz, 0);
    if (rFingerPrintPxCross != NULL) (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPxCross, tFingerPrintPxCross, 0);
    if (rFingerPrintPyCross != NULL) (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPyCross, tFingerPrintPyCross, 0);
    if (rFingerPrintPzCross != NULL) (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFingerPrintPzCross, tFingerPrintPzCross, 0);
#endif
}

#ifdef __cplusplus
}
#endif
